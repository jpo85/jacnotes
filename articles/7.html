<h1 id="facciamo-un-test">facciamo un test</h1>
<pre><code class="language-powershell"><span class="hljs-variable">$credential</span> = <span class="hljs-built_in">Import-CliXml</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;e:\script\cred_s720624.xml&quot;</span>
<span class="hljs-variable">$session</span> = <span class="hljs-built_in">New-PSSession</span> <span class="hljs-literal">-ComputerName</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$credential</span>
<span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;\\10.64.89.208\e<span class="hljs-variable">$</span>\script_install_client_symantec\setup.exe&quot;</span>
<span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System&quot;</span>
<span class="hljs-variable">$filter</span>=<span class="hljs-string">&quot;ConsentPromptBehaviorAdmin|PromptOnSecureDesktop&quot;</span>
<span class="hljs-variable">$files</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> .\host_to_install.txt
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$host_item</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$files</span>)
{
    <span class="hljs-built_in">Copy-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$file</span> <span class="hljs-literal">-ToSession</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-Destination</span> <span class="hljs-string">&#x27;c:\temp&#x27;</span>
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$path</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;ConsentPromptBehaviorAdmin&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">&quot;0&quot;</span>}
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$path</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;PromptOnSecureDesktop&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">&quot;0&quot;</span>}
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {(<span class="hljs-built_in">Get-ItemProperty</span> <span class="hljs-variable">$path</span>).psobject.properties | <span class="hljs-built_in">where</span> {<span class="hljs-variable">$_</span>.name <span class="hljs-operator">-match</span> <span class="hljs-variable">$filter</span>} | <span class="hljs-built_in">select</span> name,value}
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {c:\temp\setup.exe /s}
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Seconds</span> <span class="hljs-number">10</span>}
    <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$session</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-built_in">Get-Process</span> msiexec}
}
<span class="hljs-built_in">Read-Host</span> <span class="hljs-literal">-Prompt</span> <span class="hljs-string">&quot;Premere Invio per uscire&quot;</span>

<span class="hljs-comment"># Powered by @jacopo.pica</span>
</code></pre>
